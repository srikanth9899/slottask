{"ast":null,"code":"import { createContext, useContext, useEffect, useState, useRef, useMemo, useCallback } from 'react';\nimport { jsxs, jsx } from 'react/jsx-runtime';\nimport { useNavigationListener, useLifecycleEventListener } from '@shopify/react-performance';\nexport * from '@shopify/react-performance';\nimport EventEmitter from 'events';\nimport prom from 'promjs';\nimport { useBeforeunload } from 'react-beforeunload';\n\nfunction _arrayLikeToArray(arr, len) {\n  if (len == null || len > arr.length) len = arr.length;\n\n  for (var i = 0, arr2 = new Array(len); i < len; i++) {\n    arr2[i] = arr[i];\n  }\n\n  return arr2;\n}\n\nfunction _arrayWithoutHoles(arr) {\n  if (Array.isArray(arr)) return _arrayLikeToArray(arr);\n}\n\nfunction _iterableToArray(iter) {\n  if (typeof Symbol !== \"undefined\" && iter[Symbol.iterator] != null || iter[\"@@iterator\"] != null) return Array.from(iter);\n}\n\nfunction _unsupportedIterableToArray(o, minLen) {\n  if (!o) return;\n  if (typeof o === \"string\") return _arrayLikeToArray(o, minLen);\n  var n = Object.prototype.toString.call(o).slice(8, -1);\n  if (n === \"Object\" && o.constructor) n = o.constructor.name;\n  if (n === \"Map\" || n === \"Set\") return Array.from(o);\n  if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen);\n}\n\nfunction _nonIterableSpread() {\n  throw new TypeError(\"Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n}\n\nfunction _toConsumableArray(arr) {\n  return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _unsupportedIterableToArray(arr) || _nonIterableSpread();\n}\n\nvar GoldenMetrics;\n\n(function (GoldenMetrics) {\n  GoldenMetrics[\"AppLoaded\"] = \"prom_react_app_loaded\";\n  GoldenMetrics[\"AppUnloaded\"] = \"prom_react_app_unloaded\";\n  GoldenMetrics[\"PageNavigation\"] = \"prom_react_navigation_duration_seconds\";\n  GoldenMetrics[\"PageTimeToComplete\"] = \"prom_react_ttc_seconds\";\n  GoldenMetrics[\"PageTimeToUsable\"] = \"prom_react_ttu_seconds\";\n  GoldenMetrics[\"PerformanceTime\"] = \"prom_react_performance_seconds\";\n})(GoldenMetrics || (GoldenMetrics = {}));\n\nvar goldenMetrics = [{\n  type: 'counter',\n  name: GoldenMetrics.AppLoaded,\n  description: 'Application loaded counter'\n}, {\n  type: 'counter',\n  name: GoldenMetrics.AppUnloaded,\n  description: 'Application unloaded counter'\n}, {\n  type: 'histogram',\n  name: GoldenMetrics.PageNavigation,\n  description: 'Total navigation duration between pages in seconds'\n}, {\n  type: 'histogram',\n  name: GoldenMetrics.PageTimeToComplete,\n  description: 'Section time to interactive in seconds'\n}, {\n  type: 'histogram',\n  name: GoldenMetrics.PageTimeToUsable,\n  description: 'Section time to usable in seconds'\n}, {\n  type: 'histogram',\n  name: GoldenMetrics.PerformanceTime,\n  description: 'Application performance load time in seconds'\n}];\n\nvar createMetrics = function createMetrics(registry, defaultBuckets) {\n  var customMetrics = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : [];\n\n  if (registry.get('counter', GoldenMetrics.AppLoaded)) {\n    // Avoid creating golden metrics if they already exist\n    return;\n  }\n\n  [].concat(goldenMetrics, _toConsumableArray(customMetrics)).forEach(function (metric) {\n    switch (metric.type) {\n      case 'counter':\n        registry.create('counter', metric.name, metric.description);\n        break;\n\n      case 'histogram':\n        registry.create('histogram', metric.name, metric.description, metric.buckets || defaultBuckets);\n        break;\n    }\n  });\n};\n\nvar MetricsContext = /*#__PURE__*/createContext({});\n\nvar useMetrics = function useMetrics() {\n  return useContext(MetricsContext);\n};\n\nvar handleObserve = function handleObserve(_ref) {\n  var metricName = _ref.metricName,\n      value = _ref.value,\n      tags = _ref.tags; // eslint-disable-next-line no-console\n\n  console.log('[prom_react]', metricName, value, tags);\n};\n\nvar MetricsLogger = function MetricsLogger() {\n  var _useMetrics = useMetrics(),\n      addObserveListener = _useMetrics.addObserveListener,\n      removeObserveListener = _useMetrics.removeObserveListener;\n\n  useEffect(function () {\n    addObserveListener(handleObserve);\n    return function () {\n      removeObserveListener(handleObserve);\n    };\n  }, [addObserveListener, removeObserveListener]);\n  return null;\n};\n\nvar wrapperStyle = {\n  position: 'fixed',\n  right: 10,\n  bottom: 10,\n  padding: '15px 10px',\n  zIndex: 99999,\n  backgroundColor: 'rgba(0, 0, 0, 0.75)',\n  minWidth: '250px',\n  minHeight: '140px',\n  borderRadius: 4,\n  color: 'white',\n  fontFamily: 'Roboto, sans-serif',\n  fontSize: '1rem'\n};\nvar titleStyle = {\n  fontWeight: 'bold',\n  fontSize: '1.2rem'\n};\nvar sectionTitleStyle = {\n  fontWeight: 'bold',\n  color: '#a0c4ff',\n  margin: '4px 0',\n  fontSize: '1rem'\n};\nvar valueStyle = {\n  color: '#9bf6ff'\n};\n\nvar MetricsDebugOverlay = function MetricsDebugOverlay(_ref) {\n  var withLogger = _ref.withLogger,\n      onClose = _ref.onClose;\n\n  var _useMetrics = useMetrics(),\n      navigationData = _useMetrics.navigationData;\n\n  return /*#__PURE__*/jsxs(\"section\", {\n    className: \"prom-react-navigation-overlay\",\n    style: wrapperStyle,\n    children: [onClose && /*#__PURE__*/jsx(\"span\", {\n      onClick: function onClick() {\n        onClose();\n      },\n      style: {\n        position: 'absolute',\n        right: 5,\n        top: 5,\n        cursor: 'pointer'\n      },\n      children: \"x\"\n    }), /*#__PURE__*/jsx(\"h2\", {\n      style: titleStyle,\n      children: \"prom-react\"\n    }), /*#__PURE__*/jsx(\"h3\", {\n      style: sectionTitleStyle,\n      children: \"Last navigation\"\n    }), navigationData ? /*#__PURE__*/jsxs(\"ul\", {\n      style: {\n        marginLeft: 5\n      },\n      children: [/*#__PURE__*/jsxs(\"li\", {\n        children: [\"Pathname: \", /*#__PURE__*/jsx(\"span\", {\n          style: valueStyle,\n          children: navigationData.path\n        })]\n      }), /*#__PURE__*/jsxs(\"li\", {\n        children: [\"Navigation type:\", ' ', /*#__PURE__*/jsx(\"span\", {\n          style: valueStyle,\n          children: navigationData.isFullPageNavigation ? 'Full page' : 'In app'\n        })]\n      }), /*#__PURE__*/jsxs(\"li\", {\n        children: [\"Duration:\", ' ', /*#__PURE__*/jsxs(\"span\", {\n          style: navigationData.duration > 10000 ? {\n            color: '#ffadad'\n          } : valueStyle,\n          children: [navigationData.duration.toFixed(2), \"ms\"]\n        })]\n      }), /*#__PURE__*/jsxs(\"li\", {\n        children: [\"TTU:\", ' ', /*#__PURE__*/jsxs(\"span\", {\n          style: valueStyle,\n          children: [navigationData.timeToUsable.toFixed(2), \"ms\"]\n        })]\n      }), /*#__PURE__*/jsxs(\"li\", {\n        children: [\"TTC:\", ' ', /*#__PURE__*/jsxs(\"span\", {\n          style: valueStyle,\n          children: [navigationData.timeToComplete.toFixed(2), \"ms\"]\n        })]\n      })]\n    }) : '-', withLogger && /*#__PURE__*/jsx(MetricsLogger, {})]\n  });\n};\n\nfunction _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}\n\nfunction _arrayWithHoles(arr) {\n  if (Array.isArray(arr)) return arr;\n}\n\nfunction _iterableToArrayLimit(arr, i) {\n  var _i = arr == null ? null : typeof Symbol !== \"undefined\" && arr[Symbol.iterator] || arr[\"@@iterator\"];\n\n  if (_i == null) return;\n  var _arr = [];\n  var _n = true;\n  var _d = false;\n\n  var _s, _e;\n\n  try {\n    for (_i = _i.call(arr); !(_n = (_s = _i.next()).done); _n = true) {\n      _arr.push(_s.value);\n\n      if (i && _arr.length === i) break;\n    }\n  } catch (err) {\n    _d = true;\n    _e = err;\n  } finally {\n    try {\n      if (!_n && _i[\"return\"] != null) _i[\"return\"]();\n    } finally {\n      if (_d) throw _e;\n    }\n  }\n\n  return _arr;\n}\n\nfunction _nonIterableRest() {\n  throw new TypeError(\"Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n}\n\nfunction _slicedToArray(arr, i) {\n  return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest();\n}\n\nfunction asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) {\n  try {\n    var info = gen[key](arg);\n    var value = info.value;\n  } catch (error) {\n    reject(error);\n    return;\n  }\n\n  if (info.done) {\n    resolve(value);\n  } else {\n    Promise.resolve(value).then(_next, _throw);\n  }\n}\n\nfunction _asyncToGenerator(fn) {\n  return function () {\n    var self = this,\n        args = arguments;\n    return new Promise(function (resolve, reject) {\n      var gen = fn.apply(self, args);\n\n      function _next(value) {\n        asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"next\", value);\n      }\n\n      function _throw(err) {\n        asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"throw\", err);\n      }\n\n      _next(undefined);\n    });\n  };\n}\n\nvar runtime = {\n  exports: {}\n};\n/**\n * Copyright (c) 2014-present, Facebook, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\n(function (module) {\n  var runtime = function (exports) {\n    var Op = Object.prototype;\n    var hasOwn = Op.hasOwnProperty;\n    var undefined$1; // More compressible than void 0.\n\n    var $Symbol = typeof Symbol === \"function\" ? Symbol : {};\n    var iteratorSymbol = $Symbol.iterator || \"@@iterator\";\n    var asyncIteratorSymbol = $Symbol.asyncIterator || \"@@asyncIterator\";\n    var toStringTagSymbol = $Symbol.toStringTag || \"@@toStringTag\";\n\n    function define(obj, key, value) {\n      Object.defineProperty(obj, key, {\n        value: value,\n        enumerable: true,\n        configurable: true,\n        writable: true\n      });\n      return obj[key];\n    }\n\n    try {\n      // IE 8 has a broken Object.defineProperty that only works on DOM objects.\n      define({}, \"\");\n    } catch (err) {\n      define = function (obj, key, value) {\n        return obj[key] = value;\n      };\n    }\n\n    function wrap(innerFn, outerFn, self, tryLocsList) {\n      // If outerFn provided and outerFn.prototype is a Generator, then outerFn.prototype instanceof Generator.\n      var protoGenerator = outerFn && outerFn.prototype instanceof Generator ? outerFn : Generator;\n      var generator = Object.create(protoGenerator.prototype);\n      var context = new Context(tryLocsList || []); // The ._invoke method unifies the implementations of the .next,\n      // .throw, and .return methods.\n\n      generator._invoke = makeInvokeMethod(innerFn, self, context);\n      return generator;\n    }\n\n    exports.wrap = wrap; // Try/catch helper to minimize deoptimizations. Returns a completion\n    // record like context.tryEntries[i].completion. This interface could\n    // have been (and was previously) designed to take a closure to be\n    // invoked without arguments, but in all the cases we care about we\n    // already have an existing method we want to call, so there's no need\n    // to create a new function object. We can even get away with assuming\n    // the method takes exactly one argument, since that happens to be true\n    // in every case, so we don't have to touch the arguments object. The\n    // only additional allocation required is the completion record, which\n    // has a stable shape and so hopefully should be cheap to allocate.\n\n    function tryCatch(fn, obj, arg) {\n      try {\n        return {\n          type: \"normal\",\n          arg: fn.call(obj, arg)\n        };\n      } catch (err) {\n        return {\n          type: \"throw\",\n          arg: err\n        };\n      }\n    }\n\n    var GenStateSuspendedStart = \"suspendedStart\";\n    var GenStateSuspendedYield = \"suspendedYield\";\n    var GenStateExecuting = \"executing\";\n    var GenStateCompleted = \"completed\"; // Returning this object from the innerFn has the same effect as\n    // breaking out of the dispatch switch statement.\n\n    var ContinueSentinel = {}; // Dummy constructor functions that we use as the .constructor and\n    // .constructor.prototype properties for functions that return Generator\n    // objects. For full spec compliance, you may wish to configure your\n    // minifier not to mangle the names of these two functions.\n\n    function Generator() {}\n\n    function GeneratorFunction() {}\n\n    function GeneratorFunctionPrototype() {} // This is a polyfill for %IteratorPrototype% for environments that\n    // don't natively support it.\n\n\n    var IteratorPrototype = {};\n    define(IteratorPrototype, iteratorSymbol, function () {\n      return this;\n    });\n    var getProto = Object.getPrototypeOf;\n    var NativeIteratorPrototype = getProto && getProto(getProto(values([])));\n\n    if (NativeIteratorPrototype && NativeIteratorPrototype !== Op && hasOwn.call(NativeIteratorPrototype, iteratorSymbol)) {\n      // This environment has a native %IteratorPrototype%; use it instead\n      // of the polyfill.\n      IteratorPrototype = NativeIteratorPrototype;\n    }\n\n    var Gp = GeneratorFunctionPrototype.prototype = Generator.prototype = Object.create(IteratorPrototype);\n    GeneratorFunction.prototype = GeneratorFunctionPrototype;\n    define(Gp, \"constructor\", GeneratorFunctionPrototype);\n    define(GeneratorFunctionPrototype, \"constructor\", GeneratorFunction);\n    GeneratorFunction.displayName = define(GeneratorFunctionPrototype, toStringTagSymbol, \"GeneratorFunction\"); // Helper for defining the .next, .throw, and .return methods of the\n    // Iterator interface in terms of a single ._invoke method.\n\n    function defineIteratorMethods(prototype) {\n      [\"next\", \"throw\", \"return\"].forEach(function (method) {\n        define(prototype, method, function (arg) {\n          return this._invoke(method, arg);\n        });\n      });\n    }\n\n    exports.isGeneratorFunction = function (genFun) {\n      var ctor = typeof genFun === \"function\" && genFun.constructor;\n      return ctor ? ctor === GeneratorFunction || // For the native GeneratorFunction constructor, the best we can\n      // do is to check its .name property.\n      (ctor.displayName || ctor.name) === \"GeneratorFunction\" : false;\n    };\n\n    exports.mark = function (genFun) {\n      if (Object.setPrototypeOf) {\n        Object.setPrototypeOf(genFun, GeneratorFunctionPrototype);\n      } else {\n        genFun.__proto__ = GeneratorFunctionPrototype;\n        define(genFun, toStringTagSymbol, \"GeneratorFunction\");\n      }\n\n      genFun.prototype = Object.create(Gp);\n      return genFun;\n    }; // Within the body of any async function, `await x` is transformed to\n    // `yield regeneratorRuntime.awrap(x)`, so that the runtime can test\n    // `hasOwn.call(value, \"__await\")` to determine if the yielded value is\n    // meant to be awaited.\n\n\n    exports.awrap = function (arg) {\n      return {\n        __await: arg\n      };\n    };\n\n    function AsyncIterator(generator, PromiseImpl) {\n      function invoke(method, arg, resolve, reject) {\n        var record = tryCatch(generator[method], generator, arg);\n\n        if (record.type === \"throw\") {\n          reject(record.arg);\n        } else {\n          var result = record.arg;\n          var value = result.value;\n\n          if (value && typeof value === \"object\" && hasOwn.call(value, \"__await\")) {\n            return PromiseImpl.resolve(value.__await).then(function (value) {\n              invoke(\"next\", value, resolve, reject);\n            }, function (err) {\n              invoke(\"throw\", err, resolve, reject);\n            });\n          }\n\n          return PromiseImpl.resolve(value).then(function (unwrapped) {\n            // When a yielded Promise is resolved, its final value becomes\n            // the .value of the Promise<{value,done}> result for the\n            // current iteration.\n            result.value = unwrapped;\n            resolve(result);\n          }, function (error) {\n            // If a rejected Promise was yielded, throw the rejection back\n            // into the async generator function so it can be handled there.\n            return invoke(\"throw\", error, resolve, reject);\n          });\n        }\n      }\n\n      var previousPromise;\n\n      function enqueue(method, arg) {\n        function callInvokeWithMethodAndArg() {\n          return new PromiseImpl(function (resolve, reject) {\n            invoke(method, arg, resolve, reject);\n          });\n        }\n\n        return previousPromise = // If enqueue has been called before, then we want to wait until\n        // all previous Promises have been resolved before calling invoke,\n        // so that results are always delivered in the correct order. If\n        // enqueue has not been called before, then it is important to\n        // call invoke immediately, without waiting on a callback to fire,\n        // so that the async generator function has the opportunity to do\n        // any necessary setup in a predictable way. This predictability\n        // is why the Promise constructor synchronously invokes its\n        // executor callback, and why async functions synchronously\n        // execute code before the first await. Since we implement simple\n        // async functions in terms of async generators, it is especially\n        // important to get this right, even though it requires care.\n        previousPromise ? previousPromise.then(callInvokeWithMethodAndArg, // Avoid propagating failures to Promises returned by later\n        // invocations of the iterator.\n        callInvokeWithMethodAndArg) : callInvokeWithMethodAndArg();\n      } // Define the unified helper method that is used to implement .next,\n      // .throw, and .return (see defineIteratorMethods).\n\n\n      this._invoke = enqueue;\n    }\n\n    defineIteratorMethods(AsyncIterator.prototype);\n    define(AsyncIterator.prototype, asyncIteratorSymbol, function () {\n      return this;\n    });\n    exports.AsyncIterator = AsyncIterator; // Note that simple async functions are implemented on top of\n    // AsyncIterator objects; they just return a Promise for the value of\n    // the final result produced by the iterator.\n\n    exports.async = function (innerFn, outerFn, self, tryLocsList, PromiseImpl) {\n      if (PromiseImpl === void 0) PromiseImpl = Promise;\n      var iter = new AsyncIterator(wrap(innerFn, outerFn, self, tryLocsList), PromiseImpl);\n      return exports.isGeneratorFunction(outerFn) ? iter // If outerFn is a generator, return the full iterator.\n      : iter.next().then(function (result) {\n        return result.done ? result.value : iter.next();\n      });\n    };\n\n    function makeInvokeMethod(innerFn, self, context) {\n      var state = GenStateSuspendedStart;\n      return function invoke(method, arg) {\n        if (state === GenStateExecuting) {\n          throw new Error(\"Generator is already running\");\n        }\n\n        if (state === GenStateCompleted) {\n          if (method === \"throw\") {\n            throw arg;\n          } // Be forgiving, per 25.3.3.3.3 of the spec:\n          // https://people.mozilla.org/~jorendorff/es6-draft.html#sec-generatorresume\n\n\n          return doneResult();\n        }\n\n        context.method = method;\n        context.arg = arg;\n\n        while (true) {\n          var delegate = context.delegate;\n\n          if (delegate) {\n            var delegateResult = maybeInvokeDelegate(delegate, context);\n\n            if (delegateResult) {\n              if (delegateResult === ContinueSentinel) continue;\n              return delegateResult;\n            }\n          }\n\n          if (context.method === \"next\") {\n            // Setting context._sent for legacy support of Babel's\n            // function.sent implementation.\n            context.sent = context._sent = context.arg;\n          } else if (context.method === \"throw\") {\n            if (state === GenStateSuspendedStart) {\n              state = GenStateCompleted;\n              throw context.arg;\n            }\n\n            context.dispatchException(context.arg);\n          } else if (context.method === \"return\") {\n            context.abrupt(\"return\", context.arg);\n          }\n\n          state = GenStateExecuting;\n          var record = tryCatch(innerFn, self, context);\n\n          if (record.type === \"normal\") {\n            // If an exception is thrown from innerFn, we leave state ===\n            // GenStateExecuting and loop back for another invocation.\n            state = context.done ? GenStateCompleted : GenStateSuspendedYield;\n\n            if (record.arg === ContinueSentinel) {\n              continue;\n            }\n\n            return {\n              value: record.arg,\n              done: context.done\n            };\n          } else if (record.type === \"throw\") {\n            state = GenStateCompleted; // Dispatch the exception by looping back around to the\n            // context.dispatchException(context.arg) call above.\n\n            context.method = \"throw\";\n            context.arg = record.arg;\n          }\n        }\n      };\n    } // Call delegate.iterator[context.method](context.arg) and handle the\n    // result, either by returning a { value, done } result from the\n    // delegate iterator, or by modifying context.method and context.arg,\n    // setting context.delegate to null, and returning the ContinueSentinel.\n\n\n    function maybeInvokeDelegate(delegate, context) {\n      var method = delegate.iterator[context.method];\n\n      if (method === undefined$1) {\n        // A .throw or .return when the delegate iterator has no .throw\n        // method always terminates the yield* loop.\n        context.delegate = null;\n\n        if (context.method === \"throw\") {\n          // Note: [\"return\"] must be used for ES3 parsing compatibility.\n          if (delegate.iterator[\"return\"]) {\n            // If the delegate iterator has a return method, give it a\n            // chance to clean up.\n            context.method = \"return\";\n            context.arg = undefined$1;\n            maybeInvokeDelegate(delegate, context);\n\n            if (context.method === \"throw\") {\n              // If maybeInvokeDelegate(context) changed context.method from\n              // \"return\" to \"throw\", let that override the TypeError below.\n              return ContinueSentinel;\n            }\n          }\n\n          context.method = \"throw\";\n          context.arg = new TypeError(\"The iterator does not provide a 'throw' method\");\n        }\n\n        return ContinueSentinel;\n      }\n\n      var record = tryCatch(method, delegate.iterator, context.arg);\n\n      if (record.type === \"throw\") {\n        context.method = \"throw\";\n        context.arg = record.arg;\n        context.delegate = null;\n        return ContinueSentinel;\n      }\n\n      var info = record.arg;\n\n      if (!info) {\n        context.method = \"throw\";\n        context.arg = new TypeError(\"iterator result is not an object\");\n        context.delegate = null;\n        return ContinueSentinel;\n      }\n\n      if (info.done) {\n        // Assign the result of the finished delegate to the temporary\n        // variable specified by delegate.resultName (see delegateYield).\n        context[delegate.resultName] = info.value; // Resume execution at the desired location (see delegateYield).\n\n        context.next = delegate.nextLoc; // If context.method was \"throw\" but the delegate handled the\n        // exception, let the outer generator proceed normally. If\n        // context.method was \"next\", forget context.arg since it has been\n        // \"consumed\" by the delegate iterator. If context.method was\n        // \"return\", allow the original .return call to continue in the\n        // outer generator.\n\n        if (context.method !== \"return\") {\n          context.method = \"next\";\n          context.arg = undefined$1;\n        }\n      } else {\n        // Re-yield the result returned by the delegate method.\n        return info;\n      } // The delegate iterator is finished, so forget it and continue with\n      // the outer generator.\n\n\n      context.delegate = null;\n      return ContinueSentinel;\n    } // Define Generator.prototype.{next,throw,return} in terms of the\n    // unified ._invoke helper method.\n\n\n    defineIteratorMethods(Gp);\n    define(Gp, toStringTagSymbol, \"Generator\"); // A Generator should always return itself as the iterator object when the\n    // @@iterator function is called on it. Some browsers' implementations of the\n    // iterator prototype chain incorrectly implement this, causing the Generator\n    // object to not be returned from this call. This ensures that doesn't happen.\n    // See https://github.com/facebook/regenerator/issues/274 for more details.\n\n    define(Gp, iteratorSymbol, function () {\n      return this;\n    });\n    define(Gp, \"toString\", function () {\n      return \"[object Generator]\";\n    });\n\n    function pushTryEntry(locs) {\n      var entry = {\n        tryLoc: locs[0]\n      };\n\n      if (1 in locs) {\n        entry.catchLoc = locs[1];\n      }\n\n      if (2 in locs) {\n        entry.finallyLoc = locs[2];\n        entry.afterLoc = locs[3];\n      }\n\n      this.tryEntries.push(entry);\n    }\n\n    function resetTryEntry(entry) {\n      var record = entry.completion || {};\n      record.type = \"normal\";\n      delete record.arg;\n      entry.completion = record;\n    }\n\n    function Context(tryLocsList) {\n      // The root entry object (effectively a try statement without a catch\n      // or a finally block) gives us a place to store values thrown from\n      // locations where there is no enclosing try statement.\n      this.tryEntries = [{\n        tryLoc: \"root\"\n      }];\n      tryLocsList.forEach(pushTryEntry, this);\n      this.reset(true);\n    }\n\n    exports.keys = function (object) {\n      var keys = [];\n\n      for (var key in object) {\n        keys.push(key);\n      }\n\n      keys.reverse(); // Rather than returning an object with a next method, we keep\n      // things simple and return the next function itself.\n\n      return function next() {\n        while (keys.length) {\n          var key = keys.pop();\n\n          if (key in object) {\n            next.value = key;\n            next.done = false;\n            return next;\n          }\n        } // To avoid creating an additional object, we just hang the .value\n        // and .done properties off the next function object itself. This\n        // also ensures that the minifier will not anonymize the function.\n\n\n        next.done = true;\n        return next;\n      };\n    };\n\n    function values(iterable) {\n      if (iterable) {\n        var iteratorMethod = iterable[iteratorSymbol];\n\n        if (iteratorMethod) {\n          return iteratorMethod.call(iterable);\n        }\n\n        if (typeof iterable.next === \"function\") {\n          return iterable;\n        }\n\n        if (!isNaN(iterable.length)) {\n          var i = -1,\n              next = function next() {\n            while (++i < iterable.length) {\n              if (hasOwn.call(iterable, i)) {\n                next.value = iterable[i];\n                next.done = false;\n                return next;\n              }\n            }\n\n            next.value = undefined$1;\n            next.done = true;\n            return next;\n          };\n\n          return next.next = next;\n        }\n      } // Return an iterator with no values.\n\n\n      return {\n        next: doneResult\n      };\n    }\n\n    exports.values = values;\n\n    function doneResult() {\n      return {\n        value: undefined$1,\n        done: true\n      };\n    }\n\n    Context.prototype = {\n      constructor: Context,\n      reset: function (skipTempReset) {\n        this.prev = 0;\n        this.next = 0; // Resetting context._sent for legacy support of Babel's\n        // function.sent implementation.\n\n        this.sent = this._sent = undefined$1;\n        this.done = false;\n        this.delegate = null;\n        this.method = \"next\";\n        this.arg = undefined$1;\n        this.tryEntries.forEach(resetTryEntry);\n\n        if (!skipTempReset) {\n          for (var name in this) {\n            // Not sure about the optimal order of these conditions:\n            if (name.charAt(0) === \"t\" && hasOwn.call(this, name) && !isNaN(+name.slice(1))) {\n              this[name] = undefined$1;\n            }\n          }\n        }\n      },\n      stop: function () {\n        this.done = true;\n        var rootEntry = this.tryEntries[0];\n        var rootRecord = rootEntry.completion;\n\n        if (rootRecord.type === \"throw\") {\n          throw rootRecord.arg;\n        }\n\n        return this.rval;\n      },\n      dispatchException: function (exception) {\n        if (this.done) {\n          throw exception;\n        }\n\n        var context = this;\n\n        function handle(loc, caught) {\n          record.type = \"throw\";\n          record.arg = exception;\n          context.next = loc;\n\n          if (caught) {\n            // If the dispatched exception was caught by a catch block,\n            // then let that catch block handle the exception normally.\n            context.method = \"next\";\n            context.arg = undefined$1;\n          }\n\n          return !!caught;\n        }\n\n        for (var i = this.tryEntries.length - 1; i >= 0; --i) {\n          var entry = this.tryEntries[i];\n          var record = entry.completion;\n\n          if (entry.tryLoc === \"root\") {\n            // Exception thrown outside of any try block that could handle\n            // it, so set the completion value of the entire function to\n            // throw the exception.\n            return handle(\"end\");\n          }\n\n          if (entry.tryLoc <= this.prev) {\n            var hasCatch = hasOwn.call(entry, \"catchLoc\");\n            var hasFinally = hasOwn.call(entry, \"finallyLoc\");\n\n            if (hasCatch && hasFinally) {\n              if (this.prev < entry.catchLoc) {\n                return handle(entry.catchLoc, true);\n              } else if (this.prev < entry.finallyLoc) {\n                return handle(entry.finallyLoc);\n              }\n            } else if (hasCatch) {\n              if (this.prev < entry.catchLoc) {\n                return handle(entry.catchLoc, true);\n              }\n            } else if (hasFinally) {\n              if (this.prev < entry.finallyLoc) {\n                return handle(entry.finallyLoc);\n              }\n            } else {\n              throw new Error(\"try statement without catch or finally\");\n            }\n          }\n        }\n      },\n      abrupt: function (type, arg) {\n        for (var i = this.tryEntries.length - 1; i >= 0; --i) {\n          var entry = this.tryEntries[i];\n\n          if (entry.tryLoc <= this.prev && hasOwn.call(entry, \"finallyLoc\") && this.prev < entry.finallyLoc) {\n            var finallyEntry = entry;\n            break;\n          }\n        }\n\n        if (finallyEntry && (type === \"break\" || type === \"continue\") && finallyEntry.tryLoc <= arg && arg <= finallyEntry.finallyLoc) {\n          // Ignore the finally entry if control is not jumping to a\n          // location outside the try/catch block.\n          finallyEntry = null;\n        }\n\n        var record = finallyEntry ? finallyEntry.completion : {};\n        record.type = type;\n        record.arg = arg;\n\n        if (finallyEntry) {\n          this.method = \"next\";\n          this.next = finallyEntry.finallyLoc;\n          return ContinueSentinel;\n        }\n\n        return this.complete(record);\n      },\n      complete: function (record, afterLoc) {\n        if (record.type === \"throw\") {\n          throw record.arg;\n        }\n\n        if (record.type === \"break\" || record.type === \"continue\") {\n          this.next = record.arg;\n        } else if (record.type === \"return\") {\n          this.rval = this.arg = record.arg;\n          this.method = \"return\";\n          this.next = \"end\";\n        } else if (record.type === \"normal\" && afterLoc) {\n          this.next = afterLoc;\n        }\n\n        return ContinueSentinel;\n      },\n      finish: function (finallyLoc) {\n        for (var i = this.tryEntries.length - 1; i >= 0; --i) {\n          var entry = this.tryEntries[i];\n\n          if (entry.finallyLoc === finallyLoc) {\n            this.complete(entry.completion, entry.afterLoc);\n            resetTryEntry(entry);\n            return ContinueSentinel;\n          }\n        }\n      },\n      \"catch\": function (tryLoc) {\n        for (var i = this.tryEntries.length - 1; i >= 0; --i) {\n          var entry = this.tryEntries[i];\n\n          if (entry.tryLoc === tryLoc) {\n            var record = entry.completion;\n\n            if (record.type === \"throw\") {\n              var thrown = record.arg;\n              resetTryEntry(entry);\n            }\n\n            return thrown;\n          }\n        } // The context.catch method must only be called with a location\n        // argument that corresponds to a known catch block.\n\n\n        throw new Error(\"illegal catch attempt\");\n      },\n      delegateYield: function (iterable, resultName, nextLoc) {\n        this.delegate = {\n          iterator: values(iterable),\n          resultName: resultName,\n          nextLoc: nextLoc\n        };\n\n        if (this.method === \"next\") {\n          // Deliberately forget the last sent value so that we don't\n          // accidentally pass it on to the delegate.\n          this.arg = undefined$1;\n        }\n\n        return ContinueSentinel;\n      }\n    }; // Regardless of whether this script is executing as a CommonJS module\n    // or not, return the runtime object so that we can declare the variable\n    // regeneratorRuntime in the outer scope, which allows this module to be\n    // injected easily by `bin/regenerator --include-runtime script.js`.\n\n    return exports;\n  }( // If this script is executing as a CommonJS module, use module.exports\n  // as the regeneratorRuntime namespace. Otherwise create a new empty\n  // object. Either way, the resulting object will be used to initialize\n  // the regeneratorRuntime variable at the top of this file.\n  module.exports);\n\n  try {\n    regeneratorRuntime = runtime;\n  } catch (accidentalStrictMode) {\n    // This module should not be running in strict mode, so the above\n    // assignment should always work unless something is misconfigured. Just\n    // in case runtime.js accidentally runs in strict mode, in modern engines\n    // we can explicitly access globalThis. In older engines we can escape\n    // strict mode using a global Function call. This could conceivably fail\n    // if a Content Security Policy forbids using Function, but in that case\n    // the proper solution is to fix the accidental strict mode problem. If\n    // you've misconfigured your bundler to force strict mode and applied a\n    // CSP to forbid Function, and you're not willing to fix either of those\n    // problems, please detail your unique predicament in a GitHub issue.\n    if (typeof globalThis === \"object\") {\n      globalThis.regeneratorRuntime = runtime;\n    } else {\n      Function(\"r\", \"regeneratorRuntime = r\")(runtime);\n    }\n  }\n})(runtime);\n\nvar regenerator = runtime.exports;\n\nfunction ownKeys$1(object, enumerableOnly) {\n  var keys = Object.keys(object);\n\n  if (Object.getOwnPropertySymbols) {\n    var symbols = Object.getOwnPropertySymbols(object);\n\n    if (enumerableOnly) {\n      symbols = symbols.filter(function (sym) {\n        return Object.getOwnPropertyDescriptor(object, sym).enumerable;\n      });\n    }\n\n    keys.push.apply(keys, symbols);\n  }\n\n  return keys;\n}\n\nfunction _objectSpread$1(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i] != null ? arguments[i] : {};\n\n    if (i % 2) {\n      ownKeys$1(Object(source), true).forEach(function (key) {\n        _defineProperty(target, key, source[key]);\n      });\n    } else if (Object.getOwnPropertyDescriptors) {\n      Object.defineProperties(target, Object.getOwnPropertyDescriptors(source));\n    } else {\n      ownKeys$1(Object(source)).forEach(function (key) {\n        Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));\n      });\n    }\n  }\n\n  return target;\n}\n\nvar sendMetricsToGateway = /*#__PURE__*/function () {\n  var _ref = _asyncToGenerator( /*#__PURE__*/regenerator.mark(function _callee(registry, promGatewayUrl) {\n    var fetchOptions,\n        isAppUnloading,\n        metrics,\n        keepalive,\n        _args = arguments;\n    return regenerator.wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            fetchOptions = _args.length > 2 && _args[2] !== undefined ? _args[2] : {};\n            isAppUnloading = _args.length > 3 && _args[3] !== undefined ? _args[3] : false;\n            metrics = registry.metrics();\n\n            if (!(metrics.length > 0)) {\n              _context.next = 14;\n              break;\n            }\n\n            keepalive = isAppUnloading ? {\n              keepalive: true\n            } : {};\n            _context.prev = 5;\n            _context.next = 8;\n            return fetch(promGatewayUrl, _objectSpread$1(_objectSpread$1(_objectSpread$1({\n              body: metrics,\n              method: 'POST'\n            }, keepalive), fetchOptions), {}, {\n              headers: _objectSpread$1({\n                'Content-Type': 'text/plain;charset=UTF-8'\n              }, fetchOptions.headers)\n            }));\n\n          case 8:\n            registry.reset();\n            _context.next = 14;\n            break;\n\n          case 11:\n            _context.prev = 11;\n            _context.t0 = _context[\"catch\"](5); // eslint-disable-next-line no-console\n\n            console.error('Error while sending metrics', _context.t0);\n\n          case 14:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, _callee, null, [[5, 11]]);\n  }));\n\n  return function sendMetricsToGateway(_x, _x2) {\n    return _ref.apply(this, arguments);\n  };\n}();\n\nvar addToMetrics = function addToMetrics(_ref2) {\n  var registry = _ref2.registry,\n      metricName = _ref2.metricName,\n      value = _ref2.value,\n      tags = _ref2.tags;\n  var histogram = registry.get('histogram', metricName);\n  var counter = registry.get('counter', metricName);\n\n  if (!histogram && !counter) {\n    // eslint-disable-next-line no-console\n    console.warn(\"[prom_react] No metric found for \".concat(metricName));\n    return;\n  }\n\n  if (histogram) {\n    if (typeof value === 'number') {\n      histogram.observe(value, tags);\n    } else {\n      // eslint-disable-next-line no-console\n      console.warn(\"[prom_react] \".concat(metricName, \" is an histogram, so value is mandatory\"));\n      return;\n    }\n  }\n\n  counter === null || counter === void 0 ? void 0 : counter.add(value !== null && value !== void 0 ? value : 1, tags);\n};\n\nfunction ownKeys(object, enumerableOnly) {\n  var keys = Object.keys(object);\n\n  if (Object.getOwnPropertySymbols) {\n    var symbols = Object.getOwnPropertySymbols(object);\n\n    if (enumerableOnly) {\n      symbols = symbols.filter(function (sym) {\n        return Object.getOwnPropertyDescriptor(object, sym).enumerable;\n      });\n    }\n\n    keys.push.apply(keys, symbols);\n  }\n\n  return keys;\n}\n\nfunction _objectSpread(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i] != null ? arguments[i] : {};\n\n    if (i % 2) {\n      ownKeys(Object(source), true).forEach(function (key) {\n        _defineProperty(target, key, source[key]);\n      });\n    } else if (Object.getOwnPropertyDescriptors) {\n      Object.defineProperties(target, Object.getOwnPropertyDescriptors(source));\n    } else {\n      ownKeys(Object(source)).forEach(function (key) {\n        Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));\n      });\n    }\n  }\n\n  return target;\n}\n\nvar defaultBuckets = [0.01, 0.1, 1, 2, 3, 4, 5, 7, 10, 15];\n\nvar MetricsProvider = function MetricsProvider(_ref) {\n  var appName = _ref.appName,\n      children = _ref.children,\n      metricsAggregatorUrl = _ref.metricsAggregatorUrl,\n      getNormalizedPath = _ref.getNormalizedPath,\n      _ref$owner = _ref.owner,\n      owner = _ref$owner === void 0 ? '' : _ref$owner,\n      _ref$histogramBuckets = _ref.histogramBuckets,\n      histogramBuckets = _ref$histogramBuckets === void 0 ? defaultBuckets : _ref$histogramBuckets,\n      _ref$customMetrics = _ref.customMetrics,\n      customMetrics = _ref$customMetrics === void 0 ? [] : _ref$customMetrics,\n      fetchOptions = _ref.fetchOptions;\n\n  var _useState = useState(false),\n      _useState2 = _slicedToArray(_useState, 2),\n      isReady = _useState2[0],\n      setIsReady = _useState2[1];\n\n  var _useState3 = useState(null),\n      _useState4 = _slicedToArray(_useState3, 2),\n      navigationData = _useState4[0],\n      setNavigationData = _useState4[1];\n\n  var registry = useRef(prom());\n  var eventEmitter = useRef(new EventEmitter());\n  var defaultTags = useMemo(function () {\n    return {\n      app_name: appName,\n      owner: owner\n    };\n  }, [appName, owner]);\n  var sendMetrics = useCallback(function () {\n    var isAppUnloading = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : false;\n\n    if (!metricsAggregatorUrl) {\n      return;\n    } // eslint-disable-next-line no-void\n\n\n    void sendMetricsToGateway(registry.current, metricsAggregatorUrl, fetchOptions, isAppUnloading);\n  }, [metricsAggregatorUrl, fetchOptions]);\n  var observe = useCallback(function (metricName, extraTags, value) {\n    var skipSend = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : false;\n\n    var tags = _objectSpread(_objectSpread({}, defaultTags), extraTags);\n\n    addToMetrics({\n      metricName: metricName,\n      registry: registry.current,\n      tags: tags,\n      value: value\n    });\n    eventEmitter.current.emit('observation', {\n      metricName: metricName,\n      tags: tags,\n      value: value\n    });\n\n    if (!skipSend) {\n      sendMetrics();\n    }\n  }, [defaultTags, sendMetrics]);\n  var addObserveListener = useCallback(function (callback) {\n    eventEmitter.current.on('observation', callback);\n  }, []);\n  var removeObserveListener = useCallback(function (callback) {\n    eventEmitter.current.off('observation', callback);\n  }, []); // Cleanup load error metric if any\n\n  useEffect(function () {\n    // eslint-disable-next-line no-underscore-dangle\n    window.__PROM_REACT_LOAD_FAILURE_TIMEOUT__ && // eslint-disable-next-line no-underscore-dangle\n    clearTimeout(window.__PROM_REACT_LOAD_FAILURE_TIMEOUT__);\n  }, []);\n  useEffect(function () {\n    createMetrics(registry.current, histogramBuckets, customMetrics);\n    setIsReady(true);\n  }, [registry, histogramBuckets, customMetrics]);\n  useEffect(function () {\n    observe(GoldenMetrics.AppLoaded, {\n      status: 'success'\n    });\n  }, [appName, observe, sendMetrics]);\n  useEffect(function () {\n    return function () {\n      eventEmitter.current.removeAllListeners();\n    };\n  }, []);\n  useBeforeunload(function () {\n    observe(GoldenMetrics.AppUnloaded, {}, undefined, true);\n    sendMetrics(true);\n  });\n  useNavigationListener(function (navigation) {\n    var start = navigation.start,\n        duration = navigation.duration,\n        timeToComplete = navigation.timeToComplete,\n        timeToUsable = navigation.timeToUsable,\n        isFullPageNavigation = navigation.isFullPageNavigation,\n        target = navigation.target;\n    var path = (getNormalizedPath === null || getNormalizedPath === void 0 ? void 0 : getNormalizedPath(target)) || target;\n    setNavigationData({\n      start: start,\n      duration: duration,\n      timeToComplete: timeToComplete,\n      timeToUsable: timeToUsable,\n      isFullPageNavigation: isFullPageNavigation,\n      path: path\n    });\n    var tags = {\n      navigation_type: isFullPageNavigation ? 'full_page' : 'in_app',\n      path: path\n    };\n    observe(GoldenMetrics.PageNavigation, tags, duration / 1000, true);\n    observe(GoldenMetrics.PageTimeToComplete, tags, timeToComplete / 1000, true);\n    observe(GoldenMetrics.PageTimeToUsable, tags, timeToUsable / 1000, true);\n    sendMetrics();\n  });\n  useLifecycleEventListener(function (_ref2) {\n    var type = _ref2.type,\n        start = _ref2.start;\n    observe(GoldenMetrics.PerformanceTime, {\n      event_type: type\n    }, start / 1000, true);\n  });\n  return /*#__PURE__*/jsx(MetricsContext.Provider, {\n    value: {\n      observe: observe,\n      registry: registry.current,\n      isReady: isReady,\n      histogramBuckets: histogramBuckets,\n      navigationData: navigationData,\n      sendMetrics: sendMetrics,\n      addObserveListener: addObserveListener,\n      removeObserveListener: removeObserveListener\n    },\n    children: children\n  });\n};\n\nexport { GoldenMetrics, MetricsContext, MetricsDebugOverlay, MetricsLogger, MetricsProvider, useMetrics };","map":{"version":3,"mappings":"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","names":["_arrayLikeToArray","arr","len","length","i","arr2","Array","_arrayWithoutHoles","isArray","arrayLikeToArray","_iterableToArray","iter","Symbol","iterator","from","_unsupportedIterableToArray","o","minLen","n","Object","prototype","toString","call","slice","constructor","name","test","_nonIterableSpread","TypeError","_toConsumableArray","arrayWithoutHoles","iterableToArray","unsupportedIterableToArray","nonIterableSpread","GoldenMetrics","goldenMetrics","type","AppLoaded","description","AppUnloaded","PageNavigation","PageTimeToComplete","PageTimeToUsable","PerformanceTime","createMetrics","registry","defaultBuckets","customMetrics","get","forEach","metric","create","buckets","MetricsContext","createContext","useMetrics","useContext","handleObserve","metricName","value","tags","console","log","MetricsLogger","addObserveListener","removeObserveListener","useEffect","wrapperStyle","position","right","bottom","padding","zIndex","backgroundColor","minWidth","minHeight","borderRadius","color","fontFamily","fontSize","titleStyle","fontWeight","sectionTitleStyle","margin","valueStyle","MetricsDebugOverlay","withLogger","onClose","navigationData","_jsxs","className","style","children","_jsx","onClick","top","cursor","marginLeft","path","isFullPageNavigation","duration","toFixed","timeToUsable","timeToComplete","_defineProperty","obj","key","defineProperty","enumerable","configurable","writable","_arrayWithHoles","_iterableToArrayLimit","_i","_arr","_n","_d","_s","_e","next","done","push","err","_nonIterableRest","_slicedToArray","arrayWithHoles","iterableToArrayLimit","nonIterableRest","asyncGeneratorStep","gen","resolve","reject","_next","_throw","arg","info","error","Promise","then","_asyncToGenerator","fn","self","args","arguments","apply","undefined","runtime","exports","Op","hasOwn","hasOwnProperty","$Symbol","iteratorSymbol","asyncIteratorSymbol","asyncIterator","toStringTagSymbol","toStringTag","define","wrap","innerFn","outerFn","tryLocsList","protoGenerator","Generator","generator","context","Context","_invoke","makeInvokeMethod","tryCatch","GenStateSuspendedStart","GenStateSuspendedYield","GenStateExecuting","GenStateCompleted","ContinueSentinel","GeneratorFunction","GeneratorFunctionPrototype","IteratorPrototype","getProto","getPrototypeOf","NativeIteratorPrototype","values","Gp","displayName","defineIteratorMethods","method","isGeneratorFunction","genFun","ctor","mark","setPrototypeOf","__proto__","awrap","__await","AsyncIterator","PromiseImpl","invoke","record","result","unwrapped","previousPromise","enqueue","callInvokeWithMethodAndArg","async","state","Error","doneResult","delegate","delegateResult","maybeInvokeDelegate","sent","_sent","dispatchException","abrupt","resultName","nextLoc","pushTryEntry","locs","entry","tryLoc","catchLoc","finallyLoc","afterLoc","tryEntries","resetTryEntry","completion","reset","keys","object","reverse","pop","iterable","iteratorMethod","isNaN","skipTempReset","prev","charAt","stop","rootEntry","rootRecord","rval","exception","handle","loc","caught","hasCatch","hasFinally","finallyEntry","complete","finish","thrown","delegateYield","module","regeneratorRuntime","accidentalStrictMode","globalThis","Function","regenerator","require$$0","sendMetricsToGateway","promGatewayUrl","fetchOptions","isAppUnloading","metrics","_context","keepalive","fetch","body","headers","addToMetrics","histogram","counter","warn","observe","add","MetricsProvider","appName","metricsAggregatorUrl","getNormalizedPath","owner","histogramBuckets","useState","isReady","setIsReady","setNavigationData","useRef","prom","eventEmitter","EventEmitter","defaultTags","useMemo","app_name","sendMetrics","useCallback","current","extraTags","skipSend","emit","callback","on","off","window","__PROM_REACT_LOAD_FAILURE_TIMEOUT__","clearTimeout","status","removeAllListeners","useBeforeunload","useNavigationListener","navigation","start","target","navigation_type","useLifecycleEventListener","event_type","Provider"],"sources":["D:\\3.0 SRINIVAS-WORKS\\TEMP\\user-ui\\node_modules\\@cabify\\prom-react\\node_modules\\@babel\\runtime\\helpers\\esm\\arrayLikeToArray.js","D:\\3.0 SRINIVAS-WORKS\\TEMP\\user-ui\\node_modules\\@cabify\\prom-react\\node_modules\\@babel\\runtime\\helpers\\esm\\arrayWithoutHoles.js","D:\\3.0 SRINIVAS-WORKS\\TEMP\\user-ui\\node_modules\\@cabify\\prom-react\\node_modules\\@babel\\runtime\\helpers\\esm\\iterableToArray.js","D:\\3.0 SRINIVAS-WORKS\\TEMP\\user-ui\\node_modules\\@cabify\\prom-react\\node_modules\\@babel\\runtime\\helpers\\esm\\unsupportedIterableToArray.js","D:\\3.0 SRINIVAS-WORKS\\TEMP\\user-ui\\node_modules\\@cabify\\prom-react\\node_modules\\@babel\\runtime\\helpers\\esm\\nonIterableSpread.js","D:\\3.0 SRINIVAS-WORKS\\TEMP\\user-ui\\node_modules\\@cabify\\prom-react\\node_modules\\@babel\\runtime\\helpers\\esm\\toConsumableArray.js","D:\\3.0 SRINIVAS-WORKS\\TEMP\\user-ui\\node_modules\\@cabify\\prom-react\\src\\createMetrics.ts","D:\\3.0 SRINIVAS-WORKS\\TEMP\\user-ui\\node_modules\\@cabify\\prom-react\\src\\MetricsContext.ts","D:\\3.0 SRINIVAS-WORKS\\TEMP\\user-ui\\node_modules\\@cabify\\prom-react\\src\\MetricsLogger.tsx","D:\\3.0 SRINIVAS-WORKS\\TEMP\\user-ui\\node_modules\\@cabify\\prom-react\\src\\MetricsDebugOverlay.tsx","D:\\3.0 SRINIVAS-WORKS\\TEMP\\user-ui\\node_modules\\@cabify\\prom-react\\node_modules\\@babel\\runtime\\helpers\\esm\\defineProperty.js","D:\\3.0 SRINIVAS-WORKS\\TEMP\\user-ui\\node_modules\\@cabify\\prom-react\\node_modules\\@babel\\runtime\\helpers\\esm\\arrayWithHoles.js","D:\\3.0 SRINIVAS-WORKS\\TEMP\\user-ui\\node_modules\\@cabify\\prom-react\\node_modules\\@babel\\runtime\\helpers\\esm\\iterableToArrayLimit.js","D:\\3.0 SRINIVAS-WORKS\\TEMP\\user-ui\\node_modules\\@cabify\\prom-react\\node_modules\\@babel\\runtime\\helpers\\esm\\nonIterableRest.js","D:\\3.0 SRINIVAS-WORKS\\TEMP\\user-ui\\node_modules\\@cabify\\prom-react\\node_modules\\@babel\\runtime\\helpers\\esm\\slicedToArray.js","D:\\3.0 SRINIVAS-WORKS\\TEMP\\user-ui\\node_modules\\@cabify\\prom-react\\node_modules\\@babel\\runtime\\helpers\\esm\\asyncToGenerator.js","D:\\3.0 SRINIVAS-WORKS\\TEMP\\user-ui\\node_modules\\@cabify\\prom-react\\node_modules\\regenerator-runtime\\runtime.js","D:\\3.0 SRINIVAS-WORKS\\TEMP\\user-ui\\node_modules\\@cabify\\prom-react\\node_modules\\@babel\\runtime\\regenerator\\index.js","D:\\3.0 SRINIVAS-WORKS\\TEMP\\user-ui\\node_modules\\@cabify\\prom-react\\src\\utils.ts","D:\\3.0 SRINIVAS-WORKS\\TEMP\\user-ui\\node_modules\\@cabify\\prom-react\\src\\MetricsProvider.tsx"],"sourcesContent":["export default function _arrayLikeToArray(arr, len) {\n  if (len == null || len > arr.length) len = arr.length;\n\n  for (var i = 0, arr2 = new Array(len); i < len; i++) {\n    arr2[i] = arr[i];\n  }\n\n  return arr2;\n}","import arrayLikeToArray from \"./arrayLikeToArray.js\";\nexport default function _arrayWithoutHoles(arr) {\n  if (Array.isArray(arr)) return arrayLikeToArray(arr);\n}","export default function _iterableToArray(iter) {\n  if (typeof Symbol !== \"undefined\" && iter[Symbol.iterator] != null || iter[\"@@iterator\"] != null) return Array.from(iter);\n}","import arrayLikeToArray from \"./arrayLikeToArray.js\";\nexport default function _unsupportedIterableToArray(o, minLen) {\n  if (!o) return;\n  if (typeof o === \"string\") return arrayLikeToArray(o, minLen);\n  var n = Object.prototype.toString.call(o).slice(8, -1);\n  if (n === \"Object\" && o.constructor) n = o.constructor.name;\n  if (n === \"Map\" || n === \"Set\") return Array.from(o);\n  if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return arrayLikeToArray(o, minLen);\n}","export default function _nonIterableSpread() {\n  throw new TypeError(\"Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n}","import arrayWithoutHoles from \"./arrayWithoutHoles.js\";\nimport iterableToArray from \"./iterableToArray.js\";\nimport unsupportedIterableToArray from \"./unsupportedIterableToArray.js\";\nimport nonIterableSpread from \"./nonIterableSpread.js\";\nexport default function _toConsumableArray(arr) {\n  return arrayWithoutHoles(arr) || iterableToArray(arr) || unsupportedIterableToArray(arr) || nonIterableSpread();\n}","import { Registry } from 'promjs/registry';\n\nexport enum GoldenMetrics {\n  AppLoaded = 'prom_react_app_loaded',\n  AppUnloaded = 'prom_react_app_unloaded',\n  PageNavigation = 'prom_react_navigation_duration_seconds',\n  PageTimeToComplete = 'prom_react_ttc_seconds',\n  PageTimeToUsable = 'prom_react_ttu_seconds',\n  PerformanceTime = 'prom_react_performance_seconds',\n}\n\nexport type MetricDefinition =\n  | {\n      type: 'counter';\n      name: string;\n      description: string;\n    }\n  | {\n      type: 'histogram';\n      name: string;\n      description: string;\n      buckets?: number[];\n    };\n\nconst goldenMetrics: MetricDefinition[] = [\n  {\n    type: 'counter',\n    name: GoldenMetrics.AppLoaded,\n    description: 'Application loaded counter',\n  },\n  {\n    type: 'counter',\n    name: GoldenMetrics.AppUnloaded,\n    description: 'Application unloaded counter',\n  },\n  {\n    type: 'histogram',\n    name: GoldenMetrics.PageNavigation,\n    description: 'Total navigation duration between pages in seconds',\n  },\n  {\n    type: 'histogram',\n    name: GoldenMetrics.PageTimeToComplete,\n    description: 'Section time to interactive in seconds',\n  },\n  {\n    type: 'histogram',\n    name: GoldenMetrics.PageTimeToUsable,\n    description: 'Section time to usable in seconds',\n  },\n  {\n    type: 'histogram',\n    name: GoldenMetrics.PerformanceTime,\n    description: 'Application performance load time in seconds',\n  },\n];\n\nexport const createMetrics = (\n  registry: Registry,\n  defaultBuckets: number[],\n  customMetrics: MetricDefinition[] = [],\n) => {\n  if (registry.get('counter', GoldenMetrics.AppLoaded)) {\n    // Avoid creating golden metrics if they already exist\n    return;\n  }\n\n  [...goldenMetrics, ...customMetrics].forEach((metric) => {\n    switch (metric.type) {\n      case 'counter':\n        registry.create('counter', metric.name, metric.description);\n        break;\n      case 'histogram':\n        registry.create(\n          'histogram',\n          metric.name,\n          metric.description,\n          metric.buckets || defaultBuckets,\n        );\n        break;\n      default:\n        break;\n    }\n  });\n};\n","import { Registry } from 'promjs/registry';\nimport { createContext, useContext } from 'react';\n\nexport interface NavigationData {\n  start: number;\n  duration: number;\n  isFullPageNavigation: boolean;\n  timeToComplete: number;\n  timeToUsable: number;\n  path: string;\n}\n\nexport type ObserveCallback = (data: {\n  metricName: string;\n  tags: Record<string, string>;\n  value?: number;\n}) => void;\n\nexport interface MetricsContextValue {\n  /**\n   * Helper to add an observation to an existing metric. Note that the metric should be created in the\n   * provider. It supports both histogram and counter metrics.\n   *\n   * @param metricName Name of the metric to add observation to.\n   * @param tags Optional tags to add to the observation. All observations added with this method will have `app_name` and `owner` label properly set.\n   * @param value Value to add to the observation. It is mandatory for histogram metrics and optional for counter metrics. If not set, this\n   * method will increase the counter by `1`.\n   * @param skipSending If set to true, the observation will not be sent to the backend (you can call sendMetrics() manually to send observations).\n   *\n   * @example\n   * ```ts\n   * const { observe } = useMetrics();\n   *\n   * observe('my_app_metric_histogram', {}, 1);\n   * ```\n   */\n  observe: (\n    metricName: string,\n    tags?: Record<string, string>,\n    value?: number,\n    skipSending?: boolean,\n  ) => void;\n\n  /**\n   * promjs registry instance. You should not use this directly, but use `observe` instead.\n   * It is exposed for some extremely rare cases where you need to access the registry directly.\n   * @example\n   * const { registry, observe, histogramBuckets } = useMetrics();\n   *\n   * registry.create('histogram', 'my_app_metric_histogram', 'My app histogram metric', histogramBuckets);\n   *\n   * // later on\n   * observe('my_app_metric_histogram', {}, 1);\n   */\n  registry: Registry;\n\n  /**\n   * flag to indicate when metrics are ready to be used. Useful to avoid calling `observe` before metrics are ready.\n   */\n  isReady: boolean;\n\n  /**\n   * Send metrics to the server. Note: by default, this method is called automatically by observe, but\n   * you can call it manually whenever needed\n   */\n  sendMetrics: () => void;\n\n  /**\n   * Buckets for histograms configured in the provider\n   */\n  histogramBuckets: number[];\n\n  /**\n   * Last navigation data\n   */\n  navigationData: NavigationData | null;\n\n  /**\n   * Add a listener called whenever an observation is added to the registry.\n   */\n  addObserveListener: (callback: ObserveCallback) => void;\n\n  /**\n   * Remove observe listener\n   */\n  removeObserveListener: (callback: ObserveCallback) => void;\n}\n\nexport const MetricsContext = createContext<MetricsContextValue>(\n  {} as MetricsContextValue,\n);\n\nexport const useMetrics = () => useContext(MetricsContext);\n","import { FC, useEffect } from 'react';\n\nimport { ObserveCallback, useMetrics } from './MetricsContext';\n\nconst handleObserve: ObserveCallback = ({ metricName, value, tags }) => {\n  // eslint-disable-next-line no-console\n  console.log('[prom_react]', metricName, value, tags);\n};\n\nconst MetricsLogger: FC = () => {\n  const { addObserveListener, removeObserveListener } = useMetrics();\n\n  useEffect(() => {\n    addObserveListener(handleObserve);\n    return () => {\n      removeObserveListener(handleObserve);\n    };\n  }, [addObserveListener, removeObserveListener]);\n\n  return null;\n};\n\nexport { MetricsLogger };\n","import { CSSProperties } from 'react';\n\nimport { useMetrics } from './MetricsContext';\nimport { MetricsLogger } from './MetricsLogger';\n\nexport interface MetricsDebugOverlayProps {\n  /**\n   * Add MetricsLogger to log metrics to console.\n   */\n  withLogger?: boolean;\n\n  /**\n   * Callback called when pressing close button. If not set, the close button won't be shown\n   */\n  onClose?: () => void;\n}\n\nconst wrapperStyle: CSSProperties = {\n  position: 'fixed',\n  right: 10,\n  bottom: 10,\n  padding: '15px 10px',\n  zIndex: 99999,\n  backgroundColor: 'rgba(0, 0, 0, 0.75)',\n  minWidth: '250px',\n  minHeight: '140px',\n  borderRadius: 4,\n  color: 'white',\n  fontFamily: 'Roboto, sans-serif',\n  fontSize: '1rem',\n};\n\nconst titleStyle: CSSProperties = { fontWeight: 'bold', fontSize: '1.2rem' };\nconst sectionTitleStyle: CSSProperties = {\n  fontWeight: 'bold',\n  color: '#a0c4ff',\n  margin: '4px 0',\n  fontSize: '1rem',\n};\n\nconst valueStyle: CSSProperties = {\n  color: '#9bf6ff',\n};\n\nconst MetricsDebugOverlay = ({\n  withLogger,\n  onClose,\n}: MetricsDebugOverlayProps) => {\n  const { navigationData } = useMetrics();\n\n  return (\n    <section className=\"prom-react-navigation-overlay\" style={wrapperStyle}>\n      {onClose && (\n        <span\n          onClick={() => {\n            onClose();\n          }}\n          style={{ position: 'absolute', right: 5, top: 5, cursor: 'pointer' }}\n        >\n          x\n        </span>\n      )}\n      <h2 style={titleStyle}>prom-react</h2>\n      <h3 style={sectionTitleStyle}>Last navigation</h3>\n      {navigationData ? (\n        <ul style={{ marginLeft: 5 }}>\n          <li>\n            Pathname: <span style={valueStyle}>{navigationData.path}</span>\n          </li>\n          <li>\n            Navigation type:{' '}\n            <span style={valueStyle}>\n              {navigationData.isFullPageNavigation ? 'Full page' : 'In app'}\n            </span>\n          </li>\n          <li>\n            Duration:{' '}\n            <span\n              style={\n                navigationData.duration > 10000\n                  ? { color: '#ffadad' }\n                  : valueStyle\n              }\n            >\n              {navigationData.duration.toFixed(2)}ms\n            </span>\n          </li>\n          <li>\n            TTU:{' '}\n            <span style={valueStyle}>\n              {navigationData.timeToUsable.toFixed(2)}ms\n            </span>\n          </li>\n          <li>\n            TTC:{' '}\n            <span style={valueStyle}>\n              {navigationData.timeToComplete.toFixed(2)}ms\n            </span>\n          </li>\n        </ul>\n      ) : (\n        '-'\n      )}\n      {withLogger && <MetricsLogger />}\n    </section>\n  );\n};\n\nexport { MetricsDebugOverlay };\n","export default function _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}","export default function _arrayWithHoles(arr) {\n  if (Array.isArray(arr)) return arr;\n}","export default function _iterableToArrayLimit(arr, i) {\n  var _i = arr == null ? null : typeof Symbol !== \"undefined\" && arr[Symbol.iterator] || arr[\"@@iterator\"];\n\n  if (_i == null) return;\n  var _arr = [];\n  var _n = true;\n  var _d = false;\n\n  var _s, _e;\n\n  try {\n    for (_i = _i.call(arr); !(_n = (_s = _i.next()).done); _n = true) {\n      _arr.push(_s.value);\n\n      if (i && _arr.length === i) break;\n    }\n  } catch (err) {\n    _d = true;\n    _e = err;\n  } finally {\n    try {\n      if (!_n && _i[\"return\"] != null) _i[\"return\"]();\n    } finally {\n      if (_d) throw _e;\n    }\n  }\n\n  return _arr;\n}","export default function _nonIterableRest() {\n  throw new TypeError(\"Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n}","import arrayWithHoles from \"./arrayWithHoles.js\";\nimport iterableToArrayLimit from \"./iterableToArrayLimit.js\";\nimport unsupportedIterableToArray from \"./unsupportedIterableToArray.js\";\nimport nonIterableRest from \"./nonIterableRest.js\";\nexport default function _slicedToArray(arr, i) {\n  return arrayWithHoles(arr) || iterableToArrayLimit(arr, i) || unsupportedIterableToArray(arr, i) || nonIterableRest();\n}","function asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) {\n  try {\n    var info = gen[key](arg);\n    var value = info.value;\n  } catch (error) {\n    reject(error);\n    return;\n  }\n\n  if (info.done) {\n    resolve(value);\n  } else {\n    Promise.resolve(value).then(_next, _throw);\n  }\n}\n\nexport default function _asyncToGenerator(fn) {\n  return function () {\n    var self = this,\n        args = arguments;\n    return new Promise(function (resolve, reject) {\n      var gen = fn.apply(self, args);\n\n      function _next(value) {\n        asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"next\", value);\n      }\n\n      function _throw(err) {\n        asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"throw\", err);\n      }\n\n      _next(undefined);\n    });\n  };\n}","/**\n * Copyright (c) 2014-present, Facebook, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\nvar runtime = (function (exports) {\n  \"use strict\";\n\n  var Op = Object.prototype;\n  var hasOwn = Op.hasOwnProperty;\n  var undefined; // More compressible than void 0.\n  var $Symbol = typeof Symbol === \"function\" ? Symbol : {};\n  var iteratorSymbol = $Symbol.iterator || \"@@iterator\";\n  var asyncIteratorSymbol = $Symbol.asyncIterator || \"@@asyncIterator\";\n  var toStringTagSymbol = $Symbol.toStringTag || \"@@toStringTag\";\n\n  function define(obj, key, value) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n    return obj[key];\n  }\n  try {\n    // IE 8 has a broken Object.defineProperty that only works on DOM objects.\n    define({}, \"\");\n  } catch (err) {\n    define = function(obj, key, value) {\n      return obj[key] = value;\n    };\n  }\n\n  function wrap(innerFn, outerFn, self, tryLocsList) {\n    // If outerFn provided and outerFn.prototype is a Generator, then outerFn.prototype instanceof Generator.\n    var protoGenerator = outerFn && outerFn.prototype instanceof Generator ? outerFn : Generator;\n    var generator = Object.create(protoGenerator.prototype);\n    var context = new Context(tryLocsList || []);\n\n    // The ._invoke method unifies the implementations of the .next,\n    // .throw, and .return methods.\n    generator._invoke = makeInvokeMethod(innerFn, self, context);\n\n    return generator;\n  }\n  exports.wrap = wrap;\n\n  // Try/catch helper to minimize deoptimizations. Returns a completion\n  // record like context.tryEntries[i].completion. This interface could\n  // have been (and was previously) designed to take a closure to be\n  // invoked without arguments, but in all the cases we care about we\n  // already have an existing method we want to call, so there's no need\n  // to create a new function object. We can even get away with assuming\n  // the method takes exactly one argument, since that happens to be true\n  // in every case, so we don't have to touch the arguments object. The\n  // only additional allocation required is the completion record, which\n  // has a stable shape and so hopefully should be cheap to allocate.\n  function tryCatch(fn, obj, arg) {\n    try {\n      return { type: \"normal\", arg: fn.call(obj, arg) };\n    } catch (err) {\n      return { type: \"throw\", arg: err };\n    }\n  }\n\n  var GenStateSuspendedStart = \"suspendedStart\";\n  var GenStateSuspendedYield = \"suspendedYield\";\n  var GenStateExecuting = \"executing\";\n  var GenStateCompleted = \"completed\";\n\n  // Returning this object from the innerFn has the same effect as\n  // breaking out of the dispatch switch statement.\n  var ContinueSentinel = {};\n\n  // Dummy constructor functions that we use as the .constructor and\n  // .constructor.prototype properties for functions that return Generator\n  // objects. For full spec compliance, you may wish to configure your\n  // minifier not to mangle the names of these two functions.\n  function Generator() {}\n  function GeneratorFunction() {}\n  function GeneratorFunctionPrototype() {}\n\n  // This is a polyfill for %IteratorPrototype% for environments that\n  // don't natively support it.\n  var IteratorPrototype = {};\n  define(IteratorPrototype, iteratorSymbol, function () {\n    return this;\n  });\n\n  var getProto = Object.getPrototypeOf;\n  var NativeIteratorPrototype = getProto && getProto(getProto(values([])));\n  if (NativeIteratorPrototype &&\n      NativeIteratorPrototype !== Op &&\n      hasOwn.call(NativeIteratorPrototype, iteratorSymbol)) {\n    // This environment has a native %IteratorPrototype%; use it instead\n    // of the polyfill.\n    IteratorPrototype = NativeIteratorPrototype;\n  }\n\n  var Gp = GeneratorFunctionPrototype.prototype =\n    Generator.prototype = Object.create(IteratorPrototype);\n  GeneratorFunction.prototype = GeneratorFunctionPrototype;\n  define(Gp, \"constructor\", GeneratorFunctionPrototype);\n  define(GeneratorFunctionPrototype, \"constructor\", GeneratorFunction);\n  GeneratorFunction.displayName = define(\n    GeneratorFunctionPrototype,\n    toStringTagSymbol,\n    \"GeneratorFunction\"\n  );\n\n  // Helper for defining the .next, .throw, and .return methods of the\n  // Iterator interface in terms of a single ._invoke method.\n  function defineIteratorMethods(prototype) {\n    [\"next\", \"throw\", \"return\"].forEach(function(method) {\n      define(prototype, method, function(arg) {\n        return this._invoke(method, arg);\n      });\n    });\n  }\n\n  exports.isGeneratorFunction = function(genFun) {\n    var ctor = typeof genFun === \"function\" && genFun.constructor;\n    return ctor\n      ? ctor === GeneratorFunction ||\n        // For the native GeneratorFunction constructor, the best we can\n        // do is to check its .name property.\n        (ctor.displayName || ctor.name) === \"GeneratorFunction\"\n      : false;\n  };\n\n  exports.mark = function(genFun) {\n    if (Object.setPrototypeOf) {\n      Object.setPrototypeOf(genFun, GeneratorFunctionPrototype);\n    } else {\n      genFun.__proto__ = GeneratorFunctionPrototype;\n      define(genFun, toStringTagSymbol, \"GeneratorFunction\");\n    }\n    genFun.prototype = Object.create(Gp);\n    return genFun;\n  };\n\n  // Within the body of any async function, `await x` is transformed to\n  // `yield regeneratorRuntime.awrap(x)`, so that the runtime can test\n  // `hasOwn.call(value, \"__await\")` to determine if the yielded value is\n  // meant to be awaited.\n  exports.awrap = function(arg) {\n    return { __await: arg };\n  };\n\n  function AsyncIterator(generator, PromiseImpl) {\n    function invoke(method, arg, resolve, reject) {\n      var record = tryCatch(generator[method], generator, arg);\n      if (record.type === \"throw\") {\n        reject(record.arg);\n      } else {\n        var result = record.arg;\n        var value = result.value;\n        if (value &&\n            typeof value === \"object\" &&\n            hasOwn.call(value, \"__await\")) {\n          return PromiseImpl.resolve(value.__await).then(function(value) {\n            invoke(\"next\", value, resolve, reject);\n          }, function(err) {\n            invoke(\"throw\", err, resolve, reject);\n          });\n        }\n\n        return PromiseImpl.resolve(value).then(function(unwrapped) {\n          // When a yielded Promise is resolved, its final value becomes\n          // the .value of the Promise<{value,done}> result for the\n          // current iteration.\n          result.value = unwrapped;\n          resolve(result);\n        }, function(error) {\n          // If a rejected Promise was yielded, throw the rejection back\n          // into the async generator function so it can be handled there.\n          return invoke(\"throw\", error, resolve, reject);\n        });\n      }\n    }\n\n    var previousPromise;\n\n    function enqueue(method, arg) {\n      function callInvokeWithMethodAndArg() {\n        return new PromiseImpl(function(resolve, reject) {\n          invoke(method, arg, resolve, reject);\n        });\n      }\n\n      return previousPromise =\n        // If enqueue has been called before, then we want to wait until\n        // all previous Promises have been resolved before calling invoke,\n        // so that results are always delivered in the correct order. If\n        // enqueue has not been called before, then it is important to\n        // call invoke immediately, without waiting on a callback to fire,\n        // so that the async generator function has the opportunity to do\n        // any necessary setup in a predictable way. This predictability\n        // is why the Promise constructor synchronously invokes its\n        // executor callback, and why async functions synchronously\n        // execute code before the first await. Since we implement simple\n        // async functions in terms of async generators, it is especially\n        // important to get this right, even though it requires care.\n        previousPromise ? previousPromise.then(\n          callInvokeWithMethodAndArg,\n          // Avoid propagating failures to Promises returned by later\n          // invocations of the iterator.\n          callInvokeWithMethodAndArg\n        ) : callInvokeWithMethodAndArg();\n    }\n\n    // Define the unified helper method that is used to implement .next,\n    // .throw, and .return (see defineIteratorMethods).\n    this._invoke = enqueue;\n  }\n\n  defineIteratorMethods(AsyncIterator.prototype);\n  define(AsyncIterator.prototype, asyncIteratorSymbol, function () {\n    return this;\n  });\n  exports.AsyncIterator = AsyncIterator;\n\n  // Note that simple async functions are implemented on top of\n  // AsyncIterator objects; they just return a Promise for the value of\n  // the final result produced by the iterator.\n  exports.async = function(innerFn, outerFn, self, tryLocsList, PromiseImpl) {\n    if (PromiseImpl === void 0) PromiseImpl = Promise;\n\n    var iter = new AsyncIterator(\n      wrap(innerFn, outerFn, self, tryLocsList),\n      PromiseImpl\n    );\n\n    return exports.isGeneratorFunction(outerFn)\n      ? iter // If outerFn is a generator, return the full iterator.\n      : iter.next().then(function(result) {\n          return result.done ? result.value : iter.next();\n        });\n  };\n\n  function makeInvokeMethod(innerFn, self, context) {\n    var state = GenStateSuspendedStart;\n\n    return function invoke(method, arg) {\n      if (state === GenStateExecuting) {\n        throw new Error(\"Generator is already running\");\n      }\n\n      if (state === GenStateCompleted) {\n        if (method === \"throw\") {\n          throw arg;\n        }\n\n        // Be forgiving, per 25.3.3.3.3 of the spec:\n        // https://people.mozilla.org/~jorendorff/es6-draft.html#sec-generatorresume\n        return doneResult();\n      }\n\n      context.method = method;\n      context.arg = arg;\n\n      while (true) {\n        var delegate = context.delegate;\n        if (delegate) {\n          var delegateResult = maybeInvokeDelegate(delegate, context);\n          if (delegateResult) {\n            if (delegateResult === ContinueSentinel) continue;\n            return delegateResult;\n          }\n        }\n\n        if (context.method === \"next\") {\n          // Setting context._sent for legacy support of Babel's\n          // function.sent implementation.\n          context.sent = context._sent = context.arg;\n\n        } else if (context.method === \"throw\") {\n          if (state === GenStateSuspendedStart) {\n            state = GenStateCompleted;\n            throw context.arg;\n          }\n\n          context.dispatchException(context.arg);\n\n        } else if (context.method === \"return\") {\n          context.abrupt(\"return\", context.arg);\n        }\n\n        state = GenStateExecuting;\n\n        var record = tryCatch(innerFn, self, context);\n        if (record.type === \"normal\") {\n          // If an exception is thrown from innerFn, we leave state ===\n          // GenStateExecuting and loop back for another invocation.\n          state = context.done\n            ? GenStateCompleted\n            : GenStateSuspendedYield;\n\n          if (record.arg === ContinueSentinel) {\n            continue;\n          }\n\n          return {\n            value: record.arg,\n            done: context.done\n          };\n\n        } else if (record.type === \"throw\") {\n          state = GenStateCompleted;\n          // Dispatch the exception by looping back around to the\n          // context.dispatchException(context.arg) call above.\n          context.method = \"throw\";\n          context.arg = record.arg;\n        }\n      }\n    };\n  }\n\n  // Call delegate.iterator[context.method](context.arg) and handle the\n  // result, either by returning a { value, done } result from the\n  // delegate iterator, or by modifying context.method and context.arg,\n  // setting context.delegate to null, and returning the ContinueSentinel.\n  function maybeInvokeDelegate(delegate, context) {\n    var method = delegate.iterator[context.method];\n    if (method === undefined) {\n      // A .throw or .return when the delegate iterator has no .throw\n      // method always terminates the yield* loop.\n      context.delegate = null;\n\n      if (context.method === \"throw\") {\n        // Note: [\"return\"] must be used for ES3 parsing compatibility.\n        if (delegate.iterator[\"return\"]) {\n          // If the delegate iterator has a return method, give it a\n          // chance to clean up.\n          context.method = \"return\";\n          context.arg = undefined;\n          maybeInvokeDelegate(delegate, context);\n\n          if (context.method === \"throw\") {\n            // If maybeInvokeDelegate(context) changed context.method from\n            // \"return\" to \"throw\", let that override the TypeError below.\n            return ContinueSentinel;\n          }\n        }\n\n        context.method = \"throw\";\n        context.arg = new TypeError(\n          \"The iterator does not provide a 'throw' method\");\n      }\n\n      return ContinueSentinel;\n    }\n\n    var record = tryCatch(method, delegate.iterator, context.arg);\n\n    if (record.type === \"throw\") {\n      context.method = \"throw\";\n      context.arg = record.arg;\n      context.delegate = null;\n      return ContinueSentinel;\n    }\n\n    var info = record.arg;\n\n    if (! info) {\n      context.method = \"throw\";\n      context.arg = new TypeError(\"iterator result is not an object\");\n      context.delegate = null;\n      return ContinueSentinel;\n    }\n\n    if (info.done) {\n      // Assign the result of the finished delegate to the temporary\n      // variable specified by delegate.resultName (see delegateYield).\n      context[delegate.resultName] = info.value;\n\n      // Resume execution at the desired location (see delegateYield).\n      context.next = delegate.nextLoc;\n\n      // If context.method was \"throw\" but the delegate handled the\n      // exception, let the outer generator proceed normally. If\n      // context.method was \"next\", forget context.arg since it has been\n      // \"consumed\" by the delegate iterator. If context.method was\n      // \"return\", allow the original .return call to continue in the\n      // outer generator.\n      if (context.method !== \"return\") {\n        context.method = \"next\";\n        context.arg = undefined;\n      }\n\n    } else {\n      // Re-yield the result returned by the delegate method.\n      return info;\n    }\n\n    // The delegate iterator is finished, so forget it and continue with\n    // the outer generator.\n    context.delegate = null;\n    return ContinueSentinel;\n  }\n\n  // Define Generator.prototype.{next,throw,return} in terms of the\n  // unified ._invoke helper method.\n  defineIteratorMethods(Gp);\n\n  define(Gp, toStringTagSymbol, \"Generator\");\n\n  // A Generator should always return itself as the iterator object when the\n  // @@iterator function is called on it. Some browsers' implementations of the\n  // iterator prototype chain incorrectly implement this, causing the Generator\n  // object to not be returned from this call. This ensures that doesn't happen.\n  // See https://github.com/facebook/regenerator/issues/274 for more details.\n  define(Gp, iteratorSymbol, function() {\n    return this;\n  });\n\n  define(Gp, \"toString\", function() {\n    return \"[object Generator]\";\n  });\n\n  function pushTryEntry(locs) {\n    var entry = { tryLoc: locs[0] };\n\n    if (1 in locs) {\n      entry.catchLoc = locs[1];\n    }\n\n    if (2 in locs) {\n      entry.finallyLoc = locs[2];\n      entry.afterLoc = locs[3];\n    }\n\n    this.tryEntries.push(entry);\n  }\n\n  function resetTryEntry(entry) {\n    var record = entry.completion || {};\n    record.type = \"normal\";\n    delete record.arg;\n    entry.completion = record;\n  }\n\n  function Context(tryLocsList) {\n    // The root entry object (effectively a try statement without a catch\n    // or a finally block) gives us a place to store values thrown from\n    // locations where there is no enclosing try statement.\n    this.tryEntries = [{ tryLoc: \"root\" }];\n    tryLocsList.forEach(pushTryEntry, this);\n    this.reset(true);\n  }\n\n  exports.keys = function(object) {\n    var keys = [];\n    for (var key in object) {\n      keys.push(key);\n    }\n    keys.reverse();\n\n    // Rather than returning an object with a next method, we keep\n    // things simple and return the next function itself.\n    return function next() {\n      while (keys.length) {\n        var key = keys.pop();\n        if (key in object) {\n          next.value = key;\n          next.done = false;\n          return next;\n        }\n      }\n\n      // To avoid creating an additional object, we just hang the .value\n      // and .done properties off the next function object itself. This\n      // also ensures that the minifier will not anonymize the function.\n      next.done = true;\n      return next;\n    };\n  };\n\n  function values(iterable) {\n    if (iterable) {\n      var iteratorMethod = iterable[iteratorSymbol];\n      if (iteratorMethod) {\n        return iteratorMethod.call(iterable);\n      }\n\n      if (typeof iterable.next === \"function\") {\n        return iterable;\n      }\n\n      if (!isNaN(iterable.length)) {\n        var i = -1, next = function next() {\n          while (++i < iterable.length) {\n            if (hasOwn.call(iterable, i)) {\n              next.value = iterable[i];\n              next.done = false;\n              return next;\n            }\n          }\n\n          next.value = undefined;\n          next.done = true;\n\n          return next;\n        };\n\n        return next.next = next;\n      }\n    }\n\n    // Return an iterator with no values.\n    return { next: doneResult };\n  }\n  exports.values = values;\n\n  function doneResult() {\n    return { value: undefined, done: true };\n  }\n\n  Context.prototype = {\n    constructor: Context,\n\n    reset: function(skipTempReset) {\n      this.prev = 0;\n      this.next = 0;\n      // Resetting context._sent for legacy support of Babel's\n      // function.sent implementation.\n      this.sent = this._sent = undefined;\n      this.done = false;\n      this.delegate = null;\n\n      this.method = \"next\";\n      this.arg = undefined;\n\n      this.tryEntries.forEach(resetTryEntry);\n\n      if (!skipTempReset) {\n        for (var name in this) {\n          // Not sure about the optimal order of these conditions:\n          if (name.charAt(0) === \"t\" &&\n              hasOwn.call(this, name) &&\n              !isNaN(+name.slice(1))) {\n            this[name] = undefined;\n          }\n        }\n      }\n    },\n\n    stop: function() {\n      this.done = true;\n\n      var rootEntry = this.tryEntries[0];\n      var rootRecord = rootEntry.completion;\n      if (rootRecord.type === \"throw\") {\n        throw rootRecord.arg;\n      }\n\n      return this.rval;\n    },\n\n    dispatchException: function(exception) {\n      if (this.done) {\n        throw exception;\n      }\n\n      var context = this;\n      function handle(loc, caught) {\n        record.type = \"throw\";\n        record.arg = exception;\n        context.next = loc;\n\n        if (caught) {\n          // If the dispatched exception was caught by a catch block,\n          // then let that catch block handle the exception normally.\n          context.method = \"next\";\n          context.arg = undefined;\n        }\n\n        return !! caught;\n      }\n\n      for (var i = this.tryEntries.length - 1; i >= 0; --i) {\n        var entry = this.tryEntries[i];\n        var record = entry.completion;\n\n        if (entry.tryLoc === \"root\") {\n          // Exception thrown outside of any try block that could handle\n          // it, so set the completion value of the entire function to\n          // throw the exception.\n          return handle(\"end\");\n        }\n\n        if (entry.tryLoc <= this.prev) {\n          var hasCatch = hasOwn.call(entry, \"catchLoc\");\n          var hasFinally = hasOwn.call(entry, \"finallyLoc\");\n\n          if (hasCatch && hasFinally) {\n            if (this.prev < entry.catchLoc) {\n              return handle(entry.catchLoc, true);\n            } else if (this.prev < entry.finallyLoc) {\n              return handle(entry.finallyLoc);\n            }\n\n          } else if (hasCatch) {\n            if (this.prev < entry.catchLoc) {\n              return handle(entry.catchLoc, true);\n            }\n\n          } else if (hasFinally) {\n            if (this.prev < entry.finallyLoc) {\n              return handle(entry.finallyLoc);\n            }\n\n          } else {\n            throw new Error(\"try statement without catch or finally\");\n          }\n        }\n      }\n    },\n\n    abrupt: function(type, arg) {\n      for (var i = this.tryEntries.length - 1; i >= 0; --i) {\n        var entry = this.tryEntries[i];\n        if (entry.tryLoc <= this.prev &&\n            hasOwn.call(entry, \"finallyLoc\") &&\n            this.prev < entry.finallyLoc) {\n          var finallyEntry = entry;\n          break;\n        }\n      }\n\n      if (finallyEntry &&\n          (type === \"break\" ||\n           type === \"continue\") &&\n          finallyEntry.tryLoc <= arg &&\n          arg <= finallyEntry.finallyLoc) {\n        // Ignore the finally entry if control is not jumping to a\n        // location outside the try/catch block.\n        finallyEntry = null;\n      }\n\n      var record = finallyEntry ? finallyEntry.completion : {};\n      record.type = type;\n      record.arg = arg;\n\n      if (finallyEntry) {\n        this.method = \"next\";\n        this.next = finallyEntry.finallyLoc;\n        return ContinueSentinel;\n      }\n\n      return this.complete(record);\n    },\n\n    complete: function(record, afterLoc) {\n      if (record.type === \"throw\") {\n        throw record.arg;\n      }\n\n      if (record.type === \"break\" ||\n          record.type === \"continue\") {\n        this.next = record.arg;\n      } else if (record.type === \"return\") {\n        this.rval = this.arg = record.arg;\n        this.method = \"return\";\n        this.next = \"end\";\n      } else if (record.type === \"normal\" && afterLoc) {\n        this.next = afterLoc;\n      }\n\n      return ContinueSentinel;\n    },\n\n    finish: function(finallyLoc) {\n      for (var i = this.tryEntries.length - 1; i >= 0; --i) {\n        var entry = this.tryEntries[i];\n        if (entry.finallyLoc === finallyLoc) {\n          this.complete(entry.completion, entry.afterLoc);\n          resetTryEntry(entry);\n          return ContinueSentinel;\n        }\n      }\n    },\n\n    \"catch\": function(tryLoc) {\n      for (var i = this.tryEntries.length - 1; i >= 0; --i) {\n        var entry = this.tryEntries[i];\n        if (entry.tryLoc === tryLoc) {\n          var record = entry.completion;\n          if (record.type === \"throw\") {\n            var thrown = record.arg;\n            resetTryEntry(entry);\n          }\n          return thrown;\n        }\n      }\n\n      // The context.catch method must only be called with a location\n      // argument that corresponds to a known catch block.\n      throw new Error(\"illegal catch attempt\");\n    },\n\n    delegateYield: function(iterable, resultName, nextLoc) {\n      this.delegate = {\n        iterator: values(iterable),\n        resultName: resultName,\n        nextLoc: nextLoc\n      };\n\n      if (this.method === \"next\") {\n        // Deliberately forget the last sent value so that we don't\n        // accidentally pass it on to the delegate.\n        this.arg = undefined;\n      }\n\n      return ContinueSentinel;\n    }\n  };\n\n  // Regardless of whether this script is executing as a CommonJS module\n  // or not, return the runtime object so that we can declare the variable\n  // regeneratorRuntime in the outer scope, which allows this module to be\n  // injected easily by `bin/regenerator --include-runtime script.js`.\n  return exports;\n\n}(\n  // If this script is executing as a CommonJS module, use module.exports\n  // as the regeneratorRuntime namespace. Otherwise create a new empty\n  // object. Either way, the resulting object will be used to initialize\n  // the regeneratorRuntime variable at the top of this file.\n  typeof module === \"object\" ? module.exports : {}\n));\n\ntry {\n  regeneratorRuntime = runtime;\n} catch (accidentalStrictMode) {\n  // This module should not be running in strict mode, so the above\n  // assignment should always work unless something is misconfigured. Just\n  // in case runtime.js accidentally runs in strict mode, in modern engines\n  // we can explicitly access globalThis. In older engines we can escape\n  // strict mode using a global Function call. This could conceivably fail\n  // if a Content Security Policy forbids using Function, but in that case\n  // the proper solution is to fix the accidental strict mode problem. If\n  // you've misconfigured your bundler to force strict mode and applied a\n  // CSP to forbid Function, and you're not willing to fix either of those\n  // problems, please detail your unique predicament in a GitHub issue.\n  if (typeof globalThis === \"object\") {\n    globalThis.regeneratorRuntime = runtime;\n  } else {\n    Function(\"r\", \"regeneratorRuntime = r\")(runtime);\n  }\n}\n","module.exports = require(\"regenerator-runtime\");\n","import { Registry } from 'promjs/registry';\n\nexport const sendMetricsToGateway = async (\n  registry: Registry,\n  promGatewayUrl: string,\n  fetchOptions: Partial<RequestInit> = {},\n  isAppUnloading = false,\n) => {\n  const metrics = registry.metrics();\n  if (metrics.length > 0) {\n    const keepalive = isAppUnloading ? { keepalive: true } : {};\n\n    try {\n      await fetch(promGatewayUrl, {\n        body: metrics,\n        method: 'POST',\n        ...keepalive,\n        ...fetchOptions,\n        headers: {\n          'Content-Type': 'text/plain;charset=UTF-8',\n          ...fetchOptions.headers,\n        },\n      });\n      registry.reset();\n    } catch (e) {\n      // eslint-disable-next-line no-console\n      console.error('Error while sending metrics', e);\n    }\n  }\n};\n\nexport const addToMetrics = ({\n  registry,\n  metricName,\n  value,\n  tags,\n}: {\n  metricName: string;\n  registry: Registry;\n  tags: Record<string, string>;\n  value?: number;\n}) => {\n  const histogram = registry.get('histogram', metricName);\n  const counter = registry.get('counter', metricName);\n\n  if (!histogram && !counter) {\n    // eslint-disable-next-line no-console\n    console.warn(`[prom_react] No metric found for ${metricName}`);\n    return;\n  }\n\n  if (histogram) {\n    if (typeof value === 'number') {\n      histogram.observe(value, tags);\n    } else {\n      // eslint-disable-next-line no-console\n      console.warn(\n        `[prom_react] ${metricName} is an histogram, so value is mandatory`,\n      );\n      return;\n    }\n  }\n\n  counter?.add(value ?? 1, tags);\n};\n","import {\n  useLifecycleEventListener,\n  useNavigationListener,\n} from '@shopify/react-performance';\nimport EventEmitter from 'events';\nimport prom from 'promjs';\nimport {\n  PropsWithChildren,\n  useCallback,\n  useEffect,\n  useMemo,\n  useRef,\n  useState,\n} from 'react';\nimport { useBeforeunload } from 'react-beforeunload';\n\nimport { ObserveCallback } from '.';\nimport {\n  createMetrics,\n  GoldenMetrics,\n  MetricDefinition,\n} from './createMetrics';\nimport { MetricsContext, NavigationData } from './MetricsContext';\nimport { addToMetrics, sendMetricsToGateway } from './utils';\n\nexport interface MetricsProviderProps {\n  /**\n   * Name of the app. All metrics will include a label 'app_name' with this value.\n   */\n  appName: string;\n\n  /**\n   * Owner of the app. All metrics will include a label 'owner' with this value.\n   */\n  owner?: string;\n\n  /**\n   * Url of the push gateway aggregator. If not set, metrics will be collected but not sent.\n   */\n  metricsAggregatorUrl?: string;\n\n  /**\n   * Extra fetch options (headers, credentials, etc) to be used when sending metrics to the aggregator.\n   */\n  fetchOptions?: Partial<RequestInit>;\n\n  /**\n   * Given that all route change metrics include a 'path' label, you should add this function to avoid cardinality issues if you\n   * have parameterized routes (ex: `/products/:id`).\n   * @param path The actual path of the route (ex: `/products/123`)\n   * @returns The normalized path of the route (ex: `/products/:id`)\n   *\n   * @example\n   * ```ts\n   * const normalizePath = (path: string) => {\n   *  const match = path.match(/\\/products\\/(\\d+)/);\n   *  if (match) {\n   *  return `/products/:id`;\n   *  }\n   *  return path;\n   * }\n   * ```\n   */\n  getNormalizedPath?: (path: string) => string;\n\n  /**\n   * Bucket list for the histogram metrics. Defaulted to [0.001, 0.01, 0.1, 1, 2, 5, 10]\n   */\n  histogramBuckets?: number[];\n\n  /**\n   * Custom application metrics. Please define in a const outside the component to avoid infinite loops trying to create them.\n   * @example\n   * ```tsx\n   * const customMetrics: MetricDefinition[] = [\n   * {\n   *   type: 'counter',\n   *   name: 'test_metric',\n   *   description: 'Test metric',\n   *  },\n   * ];\n   *\n   * const MyApp = () => {\n   *  return <MetricsProvider appName=\"MyApp\" customMetrics={customMetrics}>...</MetricsProvider>\n   * }\n   * ```\n   */\n  customMetrics?: MetricDefinition[];\n}\n\nconst defaultBuckets = [0.01, 0.1, 1, 2, 3, 4, 5, 7, 10, 15];\n\nconst MetricsProvider = ({\n  appName,\n  children,\n  metricsAggregatorUrl,\n  getNormalizedPath,\n  owner = '',\n  histogramBuckets = defaultBuckets,\n  customMetrics = [],\n  fetchOptions,\n}: PropsWithChildren<MetricsProviderProps>) => {\n  const [isReady, setIsReady] = useState(false);\n  const [navigationData, setNavigationData] = useState<NavigationData | null>(\n    null,\n  );\n\n  const registry = useRef(prom());\n  const eventEmitter = useRef(new EventEmitter());\n\n  const defaultTags = useMemo(\n    () => ({\n      app_name: appName,\n      owner,\n    }),\n    [appName, owner],\n  );\n\n  const sendMetrics = useCallback(\n    (isAppUnloading = false) => {\n      if (!metricsAggregatorUrl) {\n        return;\n      }\n      // eslint-disable-next-line no-void\n      void sendMetricsToGateway(\n        registry.current,\n        metricsAggregatorUrl,\n        fetchOptions,\n        isAppUnloading,\n      );\n    },\n    [metricsAggregatorUrl, fetchOptions],\n  );\n\n  const observe = useCallback(\n    (\n      metricName: string,\n      extraTags?: Record<string, string>,\n      value?: number,\n      skipSend = false,\n    ) => {\n      const tags = { ...defaultTags, ...extraTags };\n\n      addToMetrics({\n        metricName,\n        registry: registry.current,\n        tags,\n        value,\n      });\n\n      eventEmitter.current.emit('observation', { metricName, tags, value });\n\n      if (!skipSend) {\n        sendMetrics();\n      }\n    },\n    [defaultTags, sendMetrics],\n  );\n\n  const addObserveListener = useCallback((callback: ObserveCallback) => {\n    eventEmitter.current.on('observation', callback);\n  }, []);\n\n  const removeObserveListener = useCallback((callback: ObserveCallback) => {\n    eventEmitter.current.off('observation', callback);\n  }, []);\n\n  // Cleanup load error metric if any\n  useEffect(() => {\n    // eslint-disable-next-line no-underscore-dangle\n    window.__PROM_REACT_LOAD_FAILURE_TIMEOUT__ &&\n      // eslint-disable-next-line no-underscore-dangle\n      clearTimeout(window.__PROM_REACT_LOAD_FAILURE_TIMEOUT__);\n  }, []);\n\n  useEffect(() => {\n    createMetrics(registry.current, histogramBuckets, customMetrics);\n    setIsReady(true);\n  }, [registry, histogramBuckets, customMetrics]);\n\n  useEffect(() => {\n    observe(GoldenMetrics.AppLoaded, {\n      status: 'success',\n    });\n  }, [appName, observe, sendMetrics]);\n\n  useEffect(\n    () => () => {\n      eventEmitter.current.removeAllListeners();\n    },\n    [],\n  );\n\n  useBeforeunload(() => {\n    observe(GoldenMetrics.AppUnloaded, {}, undefined, true);\n    sendMetrics(true);\n  });\n\n  useNavigationListener((navigation) => {\n    const {\n      start,\n      duration,\n      timeToComplete,\n      timeToUsable,\n      isFullPageNavigation,\n      target,\n    } = navigation;\n\n    const path = getNormalizedPath?.(target) || target;\n\n    setNavigationData({\n      start,\n      duration,\n      timeToComplete,\n      timeToUsable,\n      isFullPageNavigation,\n      path,\n    });\n\n    const tags = {\n      navigation_type: isFullPageNavigation ? 'full_page' : 'in_app',\n      path,\n    };\n\n    observe(GoldenMetrics.PageNavigation, tags, duration / 1000, true);\n    observe(\n      GoldenMetrics.PageTimeToComplete,\n      tags,\n      timeToComplete / 1000,\n      true,\n    );\n    observe(GoldenMetrics.PageTimeToUsable, tags, timeToUsable / 1000, true);\n\n    sendMetrics();\n  });\n\n  useLifecycleEventListener(({ type, start }) => {\n    observe(\n      GoldenMetrics.PerformanceTime,\n      {\n        event_type: type,\n      },\n      start / 1000,\n      true,\n    );\n  });\n\n  return (\n    <MetricsContext.Provider\n      value={{\n        observe,\n        registry: registry.current,\n        isReady,\n        histogramBuckets,\n        navigationData,\n        sendMetrics,\n        addObserveListener,\n        removeObserveListener,\n      }}\n    >\n      {children}\n    </MetricsContext.Provider>\n  );\n};\n\nexport { MetricsProvider };\n\ndeclare global {\n  interface Window {\n    __PROM_REACT_LOAD_FAILURE_TIMEOUT__?: number;\n  }\n}\n"]},"metadata":{},"sourceType":"module"}